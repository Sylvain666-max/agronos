{% load static %}
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
  <div class="container">
    
    <!-- Logo -->
    <a class="navbar-brand d-flex align-items-center" href="/">
      <img src="{% static 'img/img27.jpg.jpg' %}" alt="logo" class="logo-img me-2">
      <span class="fw-bold text-success fs-4">AgroPlateforme</span>
    </a>

    <!-- Toggler -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsMain" 
            aria-controls="navbarsMain" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <!-- Menu -->
    <div class="collapse navbar-collapse" id="navbarsMain">
      <ul class="navbar-nav ms-auto mb-2 mb-lg-0 align-items-lg-center">

        <li class="nav-item"><a class="nav-link" href="/blog/">Conseils & Formations</a></li>
        <li class="nav-item"><a class="nav-link" href="/shop/">Boutique</a></li>
        <li class="nav-item"><a class="nav-link" href="/services/">Services</a></li>
        <li class="nav-item"><a class="nav-link" href="/a-propos/">√Ä propos</a></li>
        <li class="nav-item"><a class="nav-link" href="/contact/">Contact</a></li>

        {% if is_dashboard_manager %}
        <li class="nav-item ms-lg-3">
          <a class="btn btn-warning fw-bold px-3" href="{% url 'dashboard:dashboard_home' %}">
            Dashboard
          </a>
        </li>
        {% endif %}

        <li class="nav-item ms-lg-3">
          <a href="/shop/cart/" class="btn btn-outline-success">
            Panier {% if cart|length %}<span class="badge bg-success">{{ cart|length }}</span>{% endif %}
          </a>
        </li>

        <!-- Search desktop -->
        <li class="nav-item ms-lg-3 d-none d-lg-block">
          <form class="d-flex" action="/blog/search/" method="get">
            <input class="form-control" type="search" name="q" placeholder="Recherche blog..." aria-label="Search">
          </form>
        </li>

        <!-- Search icon on mobile -->
        <li class="nav-item d-lg-none ms-2">
          <button class="btn btn-link p-0" id="searchToggle">
            üîç
          </button>
        </li>

      </ul>
    </div>
  </div>
</nav>

<!-- Overlay search for mobile -->
<div id="mobileSearch" class="mobile-search-overlay">
  <div class="overlay-content">
    <form action="/blog/search/" method="get" class="d-flex">
      <input type="search" name="q" class="form-control me-2" placeholder="Recherche blog..." required>
      <button type="submit" class="btn btn-success">Rechercher</button>
    </form>
    <button class="btn btn-outline-danger mt-3" id="closeSearch">Fermer</button>
  </div>
</div>

<style>
  /* Logo prend toute la hauteur du navbar */
  .navbar .logo-img {
    height: 100%; 
    max-height: 56px; /* hauteur max du navbar */
    width: auto;
    object-fit: contain;
  }

  .navbar-nav .nav-link {
    font-weight: 500;
    padding: 8px 15px;
    transition: color 0.2s ease-in-out;
  }
  .navbar-nav .nav-link:hover {
    color: #198754;
  }

  .navbar {
    min-height: 56px;
  }

  /* Overlay search mobile */
  .mobile-search-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(255,255,255,0.95);
    z-index: 1050;
    justify-content: center;
    align-items: center;
    text-align: center;
    padding: 20px;
  }
  .mobile-search-overlay.active {
    display: flex;




    @media (max-width: 991.98px) {
  .nav-right {
    flex-direction: column;
    align-items: stretch;
    width: 100%;
    margin-top: .75rem;
  }
  .nav-right > div, .nav-right > a, .nav-right > button {
    width: 100%;
  }
  .cart-btn, .dashboard-btn {
    width: 100%;
    text-align: center;
  }
  .search-input { width: 100%; }
  .navbar .logo-img { max-height: 50px; }
}

/* Mobile search overlay */
.mobile-search-overlay {
  display: none;
  position: fixed;
  top: 0; left: 0;
  width: 100%; height: 100%;
  background: rgba(255,255,255,0.96);
  z-index: 1050;
  justify-content: center;
  align-items: center;
  padding: 20px;
}
.mobile-search-overlay.active { display: flex; }
.overlay-content { max-width: 700px; width: 100%; }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const searchToggle = document.getElementById("searchToggle");
    const mobileSearch = document.getElementById("mobileSearch");
    const closeSearch = document.getElementById("closeSearch");

    if (searchToggle) {
      searchToggle.addEventListener("click", () => {
        mobileSearch.classList.add("active");
      });
    }

    if (closeSearch) {
      closeSearch.addEventListener("click", () => {
        mobileSearch.classList.remove("active");
      });
    }
  });
</script>
